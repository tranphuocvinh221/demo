
var itemList={	
            /*San Pham*/
                "sp001":{"name":"Gaming Asus ROG Strix G15 G513IE-HN246W","price":21990000,"photo":"image/Rog Strix G15.jpeg"},
                "sp002":{"name":"Asus Vivobook Pro 14X OLED M7400QC-KM013W","price":24490000,"photo":"image/vivobook_m7400qc_18.jpg"},
                "sp003":{"name":"Asus Zenbook 14 OLED UX3402ZA-KM219W","price":24990000,"photo":"image/zenbook_ux3402za_12.png"},
                "sp004":{"name":"Asus Gaming TUF FX517ZE-HN045W","price":25690000,"photo":"image/gaming_tuf_fx517ze_hn045w.png"},
				"sp005":{"name":"Lenovo IdeaPad Gaming 3 15IHU6 82K1004YVN","price":23990000,"photo":"image/lenovo_gaming_3_15ihu6_82k101b5vn.jpg"},
				"sp006":{"name":"Lenovo IdeaPad Gaming 3 15IAH7 82S90088VN","price":24990000,"photo":"image/lenovo_ideapad_gaming_3_15iah7_82s90088vn_1.jpg"},
				"sp007":{"name":"Lenovo IdeaPad 5 Pro 16ARH7 82SN003LVN","price":25990000,"photo":"image/IdeaPad_5_Pro_16ARH7_CT2_04.jpg"},
				"sp008":{"name":"Lenovo Thinkpad T14 Gen 3 21AH00JQVN","price":27190000,"photo":"image/lenovo_thinkpad_t14_gen_3.jpg"},
				"sp009":{"name":"Acer Aspire 7 Gaming A715 75G 58U4","price":21990000,"photo":"image/acer-aspire7-a715-75g-58u4.jpg"},
                "sp010":{"name":"Acer Swift 3 SF314 511 55QE","price":22990000,"photo":"image/acer-swift-3-sf314-511-55qe.png"},
                "sp011":{"name":"Acer Swift 3 SF314 512 56QN","price":23990000,"photo":"image/acer_swift_3_sf314_512_56QN.jpg"},
                "sp012":{"name":"Acer Nitro Gaming AN515-58-52SP","price":26490000,"photo":"image/acer_nitro_5_an515_58_52sp_1.jpg"},
            /*Phu Kien*/
                "pk001":{"name":"CỔNG CHUYỂN HYPERDRIVE 4K HDMI 6-IN-1 USB-C...","price":1990000,"photo":"./imgs/gearvn-cong-chuyen-hyperdrive-4k-hdmi-6-in-1-usb-c-hub-gn233b-666_e4fe0815637b49a89e8219e9443cd3eb_large.webp"},
                "pk002":{"name":"Cổng chuyển HyperDrive 5-in-1 USB-C Hub - HD21B","price":1190000,"photo":"./imgs/gearvn-cong-chuyen-hyperdrive-5-in-1-usb-c-hub-gn21b-666_168f1e5e76f44bb293a122f6b8a639f0_large.webp"},
                "pk003":{"name":"Cổng chuyển HyperDriver USB-C to 8K 60Hz/4K 144Hz","price":1290000,"photo":"./imgs/hd-h8k_coverright_nocover_3000x3000_1_1920x1920_2x-1-600x600_1577715f01764455b773a56621fd9b90_large.webp"},
                "pk004":{"name":"Sạc laptop Macbook New USB-C 29W MJ262ZA/A","price":1390000,"photo":"./imgs/250_25109_31ldf5zf1bl__sy450_.jpg"},
                "pk005":{"name":"Sạc MTXT Lenovo 20V - 3.25A","price":390000,"photo":"./imgs/250_284_2867_7151184986aed9f8f418938930271d37.jpg"},
                "pk006":{"name":"Adapter MTXT Dell 19.5V-3.34A (CKN,65W)","price":490000,"photo":"./imgs/250_40278_sac_laptop_dell_h1.jpg"},
                "pk007":{"name":"Pin laptop Dell V3350","price":690000,"photo":"./imgs/250_19813_dell_v3350_.jpg"},
                "pk008":{"name":"Pin laptop HP CQ42/G42/DM4/G4/1035TU","price":690000,"photo":"./imgs/250_18125_pin_hp_cq42__1_.jpg"},
                "pk009":{"name":"RAM Laptop Kingston 8Gb DDR3 1600","price":1190000,"photo":"./imgs/250_18129__kingston_ddr3_8gb_1600__haswell___1_.jpg"},
                "pk010":{"name":"Bộ nhớ trong MTXT Kingston DDR5 8Gb 4800","price":1890000,"photo":"./imgs/250_47147_kingston_fury_impact_ddr5_8gb_4800_h2.jpg"},
                "pk011":{"name":"Ổ cứng MTXT Seagate 1Tb 5400rpm SATA3","price":1390000,"photo":"./imgs/250_20775_____c___ng.jpg"},
                "pk012":{"name":"Ổ cứng MTXT Western Digital Western Scorpio...","price":1390000,"photo":"./imgs/250_18047_western_scorpio_blue_1tb__1_.jpg"},
                "pk013":{"name":"Chuột Không dây Genius NX 7010","price":200000,"photo":"./imgs/chuot-khong-day-genius-nx-7010-thumb2-600x600.jpeg"},
                "pk014":{"name":"Chuột Không dây Logitech M190","price":390000,"photo":"./imgs/chuot-khong-day-logitech-m190-thumb3-600x600.jpeg"},
                "pk015":{"name":"Chuột Không dây DareU LM115G Gấu Panda","price":245000,"photo":"./imgs/chuot-khong-day-dareu-lm115g-gau-panda-thumb3-600x600.jpeg"},
                "pk016":{"name":"Chuột Không dây A4Tech FG20","price":300000,"photo":"./imgs/chuot-khong-day-a4tech-fg20-xam-den-thumb-600x600.jpeg"},
                "pk017":{"name":"Chuột Không dây Rapoo M20 Plus","price":200000,"photo":"./imgs/chuot-khong-day-rapoo-m20-plus-thumb3-600x600.jpeg"},
                "pk018":{"name":"Chuột Không dây Logitech M190","price":390000,"photo":"./imgs/chuot-khong-day-logitech-m190-thumb3-600x600.jpeg"},
                "pk019":{"name":"Chuột Có dây Gaming HyperX Pulsefire Surge","price":620000,"photo":"./imgs/chuot-gaming-hyperx-pulsefire-surge-rgb-den-thumb1-600x600.jpeg"},
                "pk020":{"name":"Chuột Bluetooth Microsoft Arc","price":2205000,"photo":"./imgs/chuot-bluetooth-microsoft-arc-thumb3-600x600.jpeg"},
                "pk021":{"name":"Bàn Phím Không Dây DareU EK807G Đen","price":666000,"photo":"./imgs/khong-day-dareu-ek807g-thumb2-600x600.jpeg"},
                "pk022":{"name":"Bàn Phím Bluetooth DareU EK868 Đen","price":1170000,"photo":"./imgs/bluetooth-dareu-ek868-thumb-600x600.jpeg"},
                "pk023":{"name":"Bàn Phím Cơ Có Dây Gaming Razer Huntsman...","price":3550000,"photo":"./imgs/co-day-gaming-razer-huntsman-tournament-edition-thumb-600x600 (1).jpeg"},
                "pk024":{"name":"Bàn phím không dây Microsoft All-in-one...","price":890000,"photo":"./imgs/khong-day-microsoft-all-in-one-media-n9z-00028-den-thumb-600x600.jpeg"},
                "pk025":{"name":"Bàn Phím Cơ Có Dây Gaming Rapoo V500Pro","price":990000,"photo":"./imgs/co-co-day-gaming-rapoo-v500pro-vang-xanh-thumb-600x600.jpeg"},
                "pk026":{"name":"Bàn Phím Cơ Có Dây Gaming Corsair K63...","price":1575000,"photo":"./imgs/ban-phim-co-co-day-gaming-corsair-k63-den-thumb-600x600.jpeg"},
                "pk027":{"name":"Bàn phím Magic Keyboard Apple MK2A3 Trắng","price":2390000,"photo":"./imgs/ban-phim-magic-keyboard-apple-mk2a3-thumb1-600x600.jpg"},
                "pk028":{"name":"Bàn Phím Không Dây Bluetooth Logitech K580","price":1495000,"photo":"./imgs/khong-day-logitech-k580-thumb-600x600.jpeg"},
                "pk029":{"name":"True Wireless Mozard TS11 mini","price":530000,"photo":"./imgs/bluetooth-true-wireless-mozard-ts11-mini-avatar-1-1-600x600.jpg"},
                "pk030":{"name":"AirPods 2 Lightning Charge Apple MV7N2","price":3390000,"photo":"./imgs/bluetooth-airpods-2-apple-mv7n2-imei-ava-600x600.jpg"},
                "pk031":{"name":"True Wireless Realme Buds T100","price":4890000,"photo":"./imgs/airpods-3-hop-sac-khong-day-thumb-600x600.jpeg"},
                "pk032":{"name":"Tai nghe Bluetooth True Wireless VIVO Air XEW25","price":300000,"photo":"./imgs/tai-nghe-bluetooth-true-wireless-vivo-air-xew25-thumb1-600x600.jpeg"},
                "pk033":{"name":"Loa Bluetooth Sony SRS-XE200","price":2950000,"photo":"./imgs/loa-bluetooth-sony-srs-xe200-thumb2-600x600.jpg"},
                "pk034":{"name":"Loa Bluetooth Sony SRS-XE200 Cam ","price":2950000,"photo":"./imgs/loa-bluetooth-sony-srs-xe200-cam-thumb-600x600.jpg"},
                "pk035":{"name":"Loa Bluetooth Mozard S21","price":330000,"photo":"./imgs/bluetooth-mozard-s21-ava-600x600.jpg"},
                "pk036":{"name":"Loa Bluetooth Mozard H8030D","price":510000,"photo":"./imgs/loa-bluetooth-mozard-h8030d-den-thumb-1-600x600.jpg"},
            };
/*Hàm thêm sản phẩm hoặc phụ kiên vào Giỏ hàng*/
function addCart(code)
{
    var number=parseInt(document.getElementById(code).value);
    var name=itemList[code].name;
    if(number==0)return;
    if(typeof localStorage[code] === "undefined"){
        window.localStorage.setItem(code,number);
    }else{
       var current=parseInt(window.localStorage.getItem(code));
       if(current+number>100)
       {
            window.localStorage.setItem(code,100);
            alert("Mỗi mặt hàng chỉ có thể đặt 100 sản phẩm cho mỗi đơn hàng. Bạn đã đặt 100 sản phẩm của "+name+" này.");
            return;        
       }
       else            
            window.localStorage.setItem(code,current+number);      
    }
    alert("Đã cập nhật sản phẩm "+name+" với số lượng "+number+" vào giỏ hàng. Số lượng sản phẩm "+name+" đã đặt là "+parseInt(window.localStorage.getItem(code))+"."); 
}

/*Hàm mở trang Giỏ hàng*/
function openCart()
{
    window.location.href = "donhang.html";
}

/*hàm hiển thị nội dung giỏ hàng*/

function showCart()
{
var formatter = new Intl.NumberFormat('vi-VN', {
    style: 'currency',
    currency: 'VND'
    });
    var container=document.getElementById("cartDetail").getElementsByTagName('tbody')[0];
    container.innerHTML="";

    var sum=0;//tổng mỗi mặt hàng
    var totalPreTax=0;//tổng trước thuế
    var discountRate=getDiscountRate();//tỉ lệ khuyến mãi
    var taxRate=0.02;//tỉ lệ thuế    
    var discount=0;//tiền giảm giá
    var tax=0;//tiền thuế
    for(var i=0;i<window.localStorage.length;i++)
    {
     if(typeof itemList[localStorage.key(i)] === "undefined")
        continue;       
     var tr=document.createElement("tr");
     var photoCell=document.createElement("td");
     var nameCell=document.createElement("td");
     var priceCell=document.createElement("td");
     var numberCell=document.createElement("td");
     var sumCell=document.createElement("td");
     var removeCell=document.createElement("td");
     var removeLink=document.createElement("a");
     
     var item=itemList[localStorage.key(i)];
     var number=localStorage.getItem(localStorage.key(i));
     
     photoCell.style.textAlign="center";
     photoCell.innerHTML="<img src='"+item.photo+"' class='round-figure' width='100px'/>";
     
     nameCell.innerHTML=item.name;
     priceCell.innerHTML=formatter.format(item.price);
     priceCell.style.textAlign="right";
     
     numberCell.innerHTML=number;
     numberCell.style.textAlign="right";
     
     sum=number*item.price;  
     sumCell.innerHTML=formatter.format(sum);
     sumCell.style.textAlign="right";
     
     removeLink.innerHTML="<i class='fa fa-trash icon-pink'></i>";
     
     removeLink.setAttribute("href","#");
     removeLink.setAttribute("data-code",localStorage.key(i));
     removeLink.onclick=function(){
        removeCart(this.dataset.code);
         };
     removeCell.style.textAlign="center";
     removeCell.appendChild(removeLink);
     
     tr.appendChild(photoCell);
     tr.appendChild(nameCell);
     tr.appendChild(numberCell);
     tr.appendChild(priceCell);  
     tr.appendChild(sumCell);
     tr.appendChild(removeCell);
     container.appendChild(tr);
     totalPreTax+=sum;   
    }
    var discount=totalPreTax*discountRate;
    var tax=(totalPreTax-discount)*taxRate;
    document.getElementById("total_product_price").innerHTML=formatter.format(totalPreTax);  
    document.getElementById("promotion").innerHTML=discountRate+" x TPP = "+formatter.format(discount);       
    document.getElementById("total_tax").innerHTML=formatter.format(tax);    
    document.getElementById("total_order").innerHTML=formatter.format(totalPreTax-discount+tax);
    
}
// Hàm trả về tỉ lệ giảm giá đơn hàng khi đặt hàng
// Nếu đặt hàng vào ngày thứ 7 và chủ nhật và trong khoảng thời gian từ 6h30-10h00 và 20h00 đến 23h30
// Quy ra số phút trong ngày thì ta có các giá trị tương đương như sau:
//  6h30 =  6 x 60  + 30 = 390 phút
// 10h00 = 10 x 60 = 600 phút
// 20h00 = 20 x 60 = 1200 phút
// 23h30 = 23 x 60 + 30= 1410 phút
function getDiscountRate()
{
    var d=new Date();//lấy ngày hiện tại của máy tính
    var weekday=d.getDay();//lấy ngày trong tuần    
    var totalMins=d.getHours()*60+d.getMinutes();//đổi thời gian hiện tại ra số phút trong ngày
    if(weekday== 0 || weekday==6&&((totalMins>=390&&totalMins<=600)||(totalMins>=1200&&totalMins<=1410)))
        return 0.1;
    return 0;
}
/*Hàm xóa sản phẩm khỏi đơn hàng**/
function removeCart(code)
{       
    if(typeof window.localStorage[code] !== "undefined")
        {
        //xóa sản phẩm khỏi localStorage
        window.localStorage.removeItem(code);
        //Xóa nội dung của phần thân của bảng (<tbody>)
        document.getElementById("cartDetail").getElementsByTagName('tbody')[0].innerHTML="";
        //Hiển thị lại nội dung của đơn hàng
        showCart();
        }   
}

/*Cập nhật trang chi tiết đơn hàng khi cập nhật số lượng sản phẩm*/
window.onstorage = () => {
    showCart();
  };
  /*Xác nhận đơn hàng*/
  function submit(){
    var pa = document.getElementsByTagName("tr");
    if(pa.length < 7){
        alert("Vui lòng quý khách đặt ít nhất một món hàng!!!");
        return false;
    }
    alert("Đặt hàng thành công! Cảm ơn quý khách đã đồng hành với website của chúng tôi!");
    return true;
}